(()=>{"use strict";var e,l={963(){const e=window.wp.blocks,l=window.wp.i18n,n=window.wp.blockEditor,s=window.wp.components,i=window.wp.element;let o=null,r=!1,t=null,a=null;async function c(){return a||(r?Promise.resolve():t?Promise.reject(t):(a=(async()=>{try{if("object"!=typeof WebAssembly||"function"!=typeof WebAssembly.instantiate||"function"!=typeof WebAssembly.instantiateStreaming)throw new Error("WebAssembly is not supported in this browser");await new Promise((e,l)=>{if(void 0!==window.Go)return void e();const n=document.createElement("script");n.src=void 0!==window.gllInfoSettings&&window.gllInfoSettings.wasmExecUrl?window.gllInfoSettings.wasmExecUrl:"/wp-content/plugins/gll-info/assets/wasm/wasm_exec.js",n.onload=e,n.onerror=()=>l(new Error("Failed to load wasm_exec.js")),document.head.appendChild(n)});const e=new window.Go,l=await fetch(void 0!==window.gllInfoSettings&&window.gllInfoSettings.wasmUrl?window.gllInfoSettings.wasmUrl:"/wp-content/plugins/gll-info/assets/wasm/gll.wasm");if(!l.ok)throw new Error(`Failed to fetch WASM: ${l.status} ${l.statusText}`);const n=await WebAssembly.instantiateStreaming(l,e.importObject);if(o=n.instance,e.run(o),"function"!=typeof window.parseGLL)throw new Error("WASM module did not export parseGLL function");r=!0}catch(e){throw t=e,e}})(),a))}async function d(e){r||await c();const l=e instanceof Uint8Array?e:new Uint8Array(e),n=window.parseGLL(l),s=JSON.parse(n);if(!s.success)throw new Error(s.error||"Failed to parse GLL file");return s.data}const h=window.ReactJSXRuntime;function f(){return(0,h.jsxs)("svg",{viewBox:"0 0 24 24",width:"48",height:"48",fill:"none",stroke:"currentColor",strokeWidth:"1.5",children:[(0,h.jsx)("path",{d:"M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"}),(0,h.jsx)("circle",{cx:"12",cy:"12",r:"3"}),(0,h.jsx)("path",{d:"M12 9V6M12 18v-3M9 12H6M18 12h-3"})]})}function u({data:e}){if(!e)return null;const{GenSystem:n,Metadata:s,Header:i}=e;return(0,h.jsxs)("div",{className:"gll-overview",children:[n&&(0,h.jsxs)("div",{className:"gll-section",children:[(0,h.jsx)("h4",{children:(0,l.__)("System Information","gll-info")}),(0,h.jsx)("table",{className:"gll-info-table",children:(0,h.jsxs)("tbody",{children:[n.Label&&(0,h.jsxs)("tr",{children:[(0,h.jsx)("th",{children:(0,l.__)("Label","gll-info")}),(0,h.jsx)("td",{children:n.Label})]}),n.Version&&(0,h.jsxs)("tr",{children:[(0,h.jsx)("th",{children:(0,l.__)("Version","gll-info")}),(0,h.jsx)("td",{children:n.Version})]}),void 0!==n.SystemType&&(0,h.jsxs)("tr",{children:[(0,h.jsx)("th",{children:(0,l.__)("Type","gll-info")}),(0,h.jsx)("td",{children:["Line Array","Cluster","Loudspeaker"][n.SystemType]||"Unknown"})]}),n.Manufacturer&&(0,h.jsxs)("tr",{children:[(0,h.jsx)("th",{children:(0,l.__)("Manufacturer","gll-info")}),(0,h.jsx)("td",{children:n.Manufacturer})]})]})})]}),s&&s.Description&&(0,h.jsxs)("div",{className:"gll-section",children:[(0,h.jsx)("h4",{children:(0,l.__)("Description","gll-info")}),(0,h.jsx)("p",{children:s.Description})]}),i&&(0,h.jsx)("div",{className:"gll-section gll-section-muted",children:(0,h.jsxs)("small",{children:[(0,l.__)("Format Version:","gll-info")," ",i.FormatVersion," |",(0,l.__)("Valid:","gll-info")," ",i.ChecksumValid?"Yes":"No"]})})]})}function w({data:e}){if(!e?.Database?.SourceDefinitions?.length)return null;const n=e.Database.SourceDefinitions;return(0,h.jsxs)("div",{className:"gll-sources",children:[(0,h.jsxs)("h4",{children:[(0,l.__)("Acoustic Sources","gll-info")," (",n.length,")"]}),(0,h.jsx)("ul",{className:"gll-sources-list",children:n.map((e,l)=>(0,h.jsxs)("li",{className:"gll-source-item",children:[(0,h.jsx)("strong",{children:e.Definition?.Label||e.Key}),e.Definition?.NominalBandwidthFrom&&e.Definition?.NominalBandwidthTo&&(0,h.jsxs)("span",{className:"gll-source-bandwidth",children:[Math.round(e.Definition.NominalBandwidthFrom)," - ",Math.round(e.Definition.NominalBandwidthTo)," Hz"]})]},l))})]})}(0,i.createContext)({data:null,isLoading:!1,error:null,wasmReady:!1,loadFile:()=>{},loadFromUrl:()=>{},clearData:()=>{},fileName:null,fileId:null});const g=JSON.parse('{"UU":"gll-info/gll-info"}');(0,e.registerBlockType)(g.UU,{edit:function({attributes:e,setAttributes:o}){const{fileId:r,fileUrl:t,fileName:a,showOverview:g,showSources:x,showResponses:p}=e,{data:m,isLoading:j,error:v,load:y,clear:b}=function(){const[e,l]=(0,i.useState)(null),[n,s]=(0,i.useState)(!1),[o,r]=(0,i.useState)(null);return{data:e,isLoading:n,error:o,load:(0,i.useCallback)(async(e,n=!1)=>{s(!0),r(null);try{let i;if(await c(),n)i=await async function(e){const l=await fetch(e);if(!l.ok)throw new Error(`Failed to fetch GLL file: ${l.status} ${l.statusText}`);return d(await l.arrayBuffer())}(e);else{const l=await e.arrayBuffer();i=await d(l)}return l(i),s(!1),i}catch(e){return r(e),s(!1),null}},[]),clear:(0,i.useCallback)(()=>{l(null),r(null)},[])}}(),[_,S]=(0,i.useState)(!1),L=(0,n.useBlockProps)({className:"gll-info-block"});(0,i.useEffect)(()=>{!t||m||j||_||(S(!0),y(t,!0))},[t,m,j,y,_]);const N=e=>{o({fileId:e.id,fileUrl:e.url,fileName:e.filename||e.title}),S(!1),b()};return t?(0,h.jsxs)(h.Fragment,{children:[(0,h.jsxs)(n.InspectorControls,{children:[(0,h.jsxs)(s.PanelBody,{title:(0,l.__)("File","gll-info"),children:[(0,h.jsx)("p",{children:(0,h.jsx)("strong",{children:a})}),(0,h.jsx)(n.MediaUploadCheck,{children:(0,h.jsx)(n.MediaUpload,{onSelect:N,allowedTypes:["application/x-gll","application/octet-stream"],render:({open:e})=>(0,h.jsx)(s.Button,{variant:"secondary",onClick:e,style:{marginRight:"8px"},children:(0,l.__)("Replace","gll-info")})})}),(0,h.jsx)(s.Button,{variant:"link",isDestructive:!0,onClick:()=>{o({fileId:0,fileUrl:"",fileName:""}),b(),S(!1)},children:(0,l.__)("Remove","gll-info")})]}),(0,h.jsxs)(s.PanelBody,{title:(0,l.__)("Display Options","gll-info"),children:[(0,h.jsx)(s.ToggleControl,{label:(0,l.__)("Show Overview","gll-info"),checked:g,onChange:e=>o({showOverview:e})}),(0,h.jsx)(s.ToggleControl,{label:(0,l.__)("Show Sources","gll-info"),checked:x,onChange:e=>o({showSources:e})}),(0,h.jsx)(s.ToggleControl,{label:(0,l.__)("Show Responses","gll-info"),checked:p,onChange:e=>o({showResponses:e}),help:(0,l.__)("Coming soon: frequency response charts","gll-info")})]})]}),(0,h.jsxs)("div",{...L,children:[(0,h.jsxs)("div",{className:"gll-info-header",children:[(0,h.jsx)(f,{}),(0,h.jsxs)("div",{className:"gll-info-header-text",children:[(0,h.jsx)("h3",{children:a}),m?.GenSystem?.Label&&(0,h.jsx)("p",{children:m.GenSystem.Label})]})]}),j&&(0,h.jsxs)("div",{className:"gll-info-loading",children:[(0,h.jsx)(s.Spinner,{}),(0,h.jsx)("span",{children:(0,l.__)("Parsing GLL file...","gll-info")})]}),v&&(0,h.jsxs)("div",{className:"gll-info-error",children:[(0,h.jsx)("p",{children:(0,l.__)("Error loading GLL file:","gll-info")}),(0,h.jsx)("code",{children:v.message})]}),m&&!j&&(0,h.jsxs)("div",{className:"gll-info-content",children:[g&&(0,h.jsx)(u,{data:m}),x&&(0,h.jsx)(w,{data:m})]})]})]}):(0,h.jsx)("div",{...L,children:(0,h.jsx)(s.Placeholder,{icon:(0,h.jsx)(f,{}),label:(0,l.__)("GLL File Viewer","gll-info"),instructions:(0,l.__)("Select a GLL file from your media library to display loudspeaker data.","gll-info"),children:(0,h.jsx)(n.MediaUploadCheck,{children:(0,h.jsx)(n.MediaUpload,{onSelect:N,allowedTypes:["application/x-gll","application/octet-stream"],render:({open:e})=>(0,h.jsx)(s.Button,{variant:"primary",onClick:e,children:(0,l.__)("Select GLL File","gll-info")})})})})})},save:function({attributes:e}){const{fileId:l,fileUrl:s,fileName:i,showOverview:o,showSources:r,showResponses:t}=e;if(!s)return null;const a=n.useBlockProps.save({className:"gll-info-block","data-file-url":s,"data-file-id":l||"","data-file-name":i||"","data-show-overview":o?"true":"false","data-show-sources":r?"true":"false","data-show-responses":t?"true":"false"});return(0,h.jsxs)("div",{...a,children:[(0,h.jsxs)("div",{className:"gll-info-header",children:[(0,h.jsxs)("svg",{viewBox:"0 0 24 24",width:"48",height:"48",fill:"none",stroke:"currentColor",strokeWidth:"1.5",children:[(0,h.jsx)("circle",{cx:"12",cy:"12",r:"3"}),(0,h.jsx)("path",{d:"M12 9V6M12 18v-3M9 12H6M18 12h-3"})]}),(0,h.jsxs)("div",{className:"gll-info-header-text",children:[(0,h.jsx)("h3",{children:i}),(0,h.jsx)("p",{className:"gll-loading-text",children:"Loading GLL data..."})]})]}),(0,h.jsxs)("div",{className:"gll-info-loading",children:[(0,h.jsx)("span",{className:"gll-spinner"}),(0,h.jsx)("span",{children:"Parsing GLL file..."})]}),(0,h.jsx)("div",{className:"gll-info-content",style:{display:"none"}})]})}})}},n={};function s(e){var i=n[e];if(void 0!==i)return i.exports;var o=n[e]={exports:{}};return l[e](o,o.exports,s),o.exports}s.m=l,e=[],s.O=(l,n,i,o)=>{if(!n){var r=1/0;for(d=0;d<e.length;d++){for(var[n,i,o]=e[d],t=!0,a=0;a<n.length;a++)(!1&o||r>=o)&&Object.keys(s.O).every(e=>s.O[e](n[a]))?n.splice(a--,1):(t=!1,o<r&&(r=o));if(t){e.splice(d--,1);var c=i();void 0!==c&&(l=c)}}return l}o=o||0;for(var d=e.length;d>0&&e[d-1][2]>o;d--)e[d]=e[d-1];e[d]=[n,i,o]},s.o=(e,l)=>Object.prototype.hasOwnProperty.call(e,l),(()=>{var e={314:0,350:0};s.O.j=l=>0===e[l];var l=(l,n)=>{var i,o,[r,t,a]=n,c=0;if(r.some(l=>0!==e[l])){for(i in t)s.o(t,i)&&(s.m[i]=t[i]);if(a)var d=a(s)}for(l&&l(n);c<r.length;c++)o=r[c],s.o(e,o)&&e[o]&&e[o][0](),e[o]=0;return s.O(d)},n=globalThis.webpackChunkgll_info=globalThis.webpackChunkgll_info||[];n.forEach(l.bind(null,0)),n.push=l.bind(null,n.push.bind(n))})();var i=s.O(void 0,[350],()=>s(963));i=s.O(i)})();