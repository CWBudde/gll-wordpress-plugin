!function(){"use strict";let t=!1,e=null,n=null;function o(){return window.gllInfoSettings||{wasmUrl:"/wp-content/plugins/gll-info/assets/wasm/gll.wasm",wasmExecUrl:"/wp-content/plugins/gll-info/assets/wasm/wasm_exec.js"}}function i(t){if("number"!=typeof t||Number.isNaN(t))return null;const e=Math.round(10*t)/10;return Number.isInteger(e)?`${e}`:e.toFixed(1)}function r(t){const e=i(t);return null===e?"-":`${e}Â°`}function l(t){return t?Array.isArray(t)?t:"object"==typeof t?Object.values(t):[]:[]}function s(t){const e=t.length;let n='<div class="gll-source-placements"><details>';return n+=`<summary>Placements (${e})</summary>`,n+='<div class="gll-source-placements-list">',0===e?n+='<div class="gll-empty-state gll-source-placements-empty">No placements found</div>':t.forEach(t=>{var e,o,l,s,c,u,d;const f=t.rotation||{},m=null!==(e=null!==(o=null!==(l=f.Heading)&&void 0!==l?l:f.H)&&void 0!==o?o:f.Yaw)&&void 0!==e?e:f.Azimuth,y=null!==(s=null!==(c=null!==(u=f.Vertical)&&void 0!==u?u:f.V)&&void 0!==c?c:f.Pitch)&&void 0!==s?s:f.Elevation,g=null!==(d=f.Roll)&&void 0!==d?d:f.R,w=a(t.boxLabel||"Unknown"),p=t.boxKey?` (${a(t.boxKey)})`:"",v=a(t.sourceLabel||t.sourceKey||"Unknown"),h=a(t.sourceKey||"-"),b=a(function(t){var e,n,o,r,l,s;if(!t)return"-";const a=null!==(e=null!==(n=t.x)&&void 0!==n?n:t.X)&&void 0!==e?e:t[0],c=null!==(o=null!==(r=t.y)&&void 0!==r?r:t.Y)&&void 0!==o?o:t[1],u=null!==(l=null!==(s=t.z)&&void 0!==s?s:t.Z)&&void 0!==l?l:t[2],d=i(a),f=i(c),m=i(u);return null===d&&null===f&&null===m?"-":["X: "+(null===d?"-":`${d} mm`),"Y: "+(null===f?"-":`${f} mm`),"Z: "+(null===m?"-":`${m} mm`)].join(", ")}(t.position));n+='<div class="gll-source-placement">',n+=`<div class="gll-source-placement-detail"><strong>Box:</strong> ${w}${p}</div>`,n+=`<div class="gll-source-placement-detail"><strong>Source:</strong> ${v} (${h})</div>`,n+=`<div class="gll-source-placement-detail"><strong>Position:</strong> ${b}</div>`,n+=`<div class="gll-source-placement-detail"><strong>Rotation:</strong> H: ${r(m)}, V: ${r(y)}, R: ${r(g)}</div>`,n+="</div>"}),n+="</div></details></div>",n}function a(t){const e=document.createElement("div");return e.textContent=t,e.innerHTML}async function c(i){const r=i.dataset.fileUrl;if(!r)return;const c="true"===i.dataset.showOverview,u="true"===i.dataset.showSources,d=i.querySelector(".gll-info-loading"),f=i.querySelector(".gll-info-content"),m=i.querySelector(".gll-loading-text");try{const i=await async function(i){await async function(){if(!t)return n||(n=(async()=>{try{await new Promise((t,e)=>{if(void 0!==window.Go)return void t(void 0);const n=document.createElement("script");n.src=o().wasmExecUrl,n.onload=()=>t(void 0),n.onerror=()=>e(new Error("Failed to load wasm_exec.js")),document.head.appendChild(n)});const e=new window.Go,n=await fetch(o().wasmUrl);if(!n.ok)throw new Error(`Failed to fetch WASM: ${n.status}`);const i=await WebAssembly.instantiateStreaming(n,e.importObject);if(e.run(i.instance),"function"!=typeof window.parseGLL)throw new Error("WASM module did not export parseGLL function");t=!0}catch(t){throw e=t,t}})(),n)}();const r=await fetch(i);if(!r.ok)throw new Error(`Failed to fetch GLL file: ${r.status}`);const l=await r.arrayBuffer(),s=new Uint8Array(l),a=window.parseGLL(s),c=JSON.parse(a);if(!c.success)throw new Error(c.error||"Failed to parse GLL file");return c.data}(r);m&&i.GenSystem?.Label&&(m.textContent=i.GenSystem.Label);let y="";c&&(y+=function(t){const{GenSystem:e,Metadata:n}=t;let o="";return e&&(o+='<div class="gll-section"><h4>System Information</h4>',o+='<table class="gll-info-table"><tbody>',e.Label&&(o+=`<tr><th>Label</th><td>${a(e.Label)}</td></tr>`),e.Version&&(o+=`<tr><th>Version</th><td>${a(e.Version)}</td></tr>`),void 0!==e.SystemType&&(o+=`<tr><th>Type</th><td>${["Line Array","Cluster","Loudspeaker"][e.SystemType]||"Unknown"}</td></tr>`),e.Manufacturer&&(o+=`<tr><th>Manufacturer</th><td>${a(e.Manufacturer)}</td></tr>`),o+="</tbody></table></div>"),n&&n.Description&&(o+=`<div class="gll-section"><h4>Description</h4><p>${a(n.Description)}</p></div>`),o}(i)),u&&(y+=function(t){if(!t?.Database?.SourceDefinitions?.length)return"";const e=t.Database.SourceDefinitions,n=function(t){const e=new Map;if(!t?.Database)return e;const n=Array.isArray(t.Database.SourceDefinitions)?t.Database.SourceDefinitions:[];return l(t.Database.BoxTypes||t.Database.box_types||t.Database.Box_Types).forEach(t=>{const o=l(t?.SourcePlacements||t?.source_placements||t?.Sources||t?.SourceDefinitions||t?.SourcePlacement);if(0===o.length)return;const i=t?.Label||t?.Name||t?.Key||"Unknown",r=t?.Key||t?.Id||t?.Name||"-";o.forEach(t=>{const o=t?.SourceDefinitionKey||t?.SourceDefinition?.Key||t?.SourceDefinition?.KeyRef||t?.SourceKey||t?.Source?.Key||("number"==typeof t?.SourceIndex?n[t.SourceIndex]?.Key:null)||t?.Key;if(!o)return;const l={boxLabel:i,boxKey:r,sourceLabel:t?.Label||t?.SourceLabel||t?.Source?.Label||t?.SourceName,sourceKey:o,position:t?.Position||t?.PositionMM||t?.PositionMm||t?.Offset||t?.Location||t?.Coordinates,rotation:t?.Rotation||t?.RotationAngles||t?.Orientation||t?.Angles||t?.Euler},s=e.get(o)||[];s.push(l),e.set(o,s)})}),e}(t);let o=`<div class="gll-sources"><h4>Acoustic Sources (${e.length})</h4>`;o+='<ul class="gll-sources-list">';for(const t of e){const e=t.Definition?.Label||t.Key,i=t.Definition?.NominalBandwidthFrom,r=t.Definition?.NominalBandwidthTo;o+='<li class="gll-source-item">',o+=`<strong>${a(e)}</strong>`,i&&r&&(o+=`<span class="gll-source-bandwidth">${Math.round(i)} - ${Math.round(r)} Hz</span>`),o+=s(n.get(t.Key)||[]),o+="</li>"}return o+="</ul></div>",o}(i)),f&&(f.innerHTML=y,f.style.display=""),d&&(d.style.display="none")}catch(t){d&&(d.innerHTML=`\n\t\t\t\t\t<div class="gll-info-error">\n\t\t\t\t\t\t<p>Error loading GLL file:</p>\n\t\t\t\t\t\t<code>${a(t.message)}</code>\n\t\t\t\t\t</div>\n\t\t\t\t`)}}function u(){document.querySelectorAll(".wp-block-gll-info-gll-info").forEach(c)}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",u):u()}();